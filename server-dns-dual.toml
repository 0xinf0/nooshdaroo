# Dual-Transport DNS Tunnel Server Configuration
# Listens on port 53 for both UDP and TCP with Noise encryption

mode = "server"

[server]
# Bind to all interfaces on port 53 (requires root/CAP_NET_BIND_SERVICE)
bind_addr = "0.0.0.0:53"

# Transport mode: "tcp", "udp", or "dual"
# - tcp: Stream-based DNS-over-TCP (existing behavior)
# - udp: Stateless DNS queries with session tracking
# - dual: Both TCP and UDP on same port (RECOMMENDED)
transport_mode = "dual"

# Protocol to emulate for PSF wrapping
# Options: "dns", "dns-google", "https", "tls"
# For DNS tunnel, use "dns" or "dns-google" for maximum legitimacy
protocol = "dns"

[transport]
# Noise Protocol pattern
# - nk: Server authentication only (RECOMMENDED - client stays anonymous)
# - xx: No pre-shared keys (mutual auth during handshake)
# - kk: Mutual authentication (both sides pre-share keys)
pattern = "nk"

# Server's private key (base64-encoded X25519 key)
# Generate with: nooshdaroo keygen
local_private_key = "INSERT_SERVER_PRIVATE_KEY_HERE"

# Remote public key (only needed for KK pattern)
# remote_public_key = "..."

[detection]
# Enable TLS session emulation (wraps all data in TLS Application Data records)
# Only applicable for HTTPS/TLS protocols, not DNS
enable_tls_session_emulation = false

# DNS-specific DPI evasion
[dns_evasion]
# Randomize response timing to match real DNS servers (50-150ms)
randomize_timing = true

# Add jitter to packet sizes
randomize_padding = true

# Respond with NXDOMAIN for invalid sessions (honeypot)
honeypot_invalid_sessions = true

[logging]
level = "info"
format = "json"  # or "text"

# Example usage:
# 1. Generate server keypair:
#    nooshdaroo keygen
#
# 2. Copy server's PRIVATE key to this file (local_private_key)
#    Copy server's PUBLIC key to client config (remote_public_key)
#
# 3. Run server (requires root for port 53):
#    sudo nooshdaroo --config server-dns-dual.toml
#
# 4. Run client:
#    nooshdaroo --config client-dns-dual.toml
